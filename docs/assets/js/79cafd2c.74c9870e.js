"use strict";(self.webpackChunk_nyx_discord_docs=self.webpackChunk_nyx_discord_docs||[]).push([[9246],{717:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>a,toc:()=>u});var r=t(7458),l=t(6436),i=t(52),s=t(9262);const d={title:"\ufe0f\ud83d\udee1\ufe0f Schedule Interception"},c=void 0,a={id:"features/schedules/schedule-interception",title:"\ufe0f\ud83d\udee1\ufe0f Schedule Interception",description:"Schedule interception refers to blocking a schedule from being executed. In nyx, there are two ways to do this:",source:"@site/docs/features/schedules/schedule-interception.mdx",sourceDirName:"features/schedules",slug:"/features/schedules/schedule-interception",permalink:"/nyx/docs/features/schedules/schedule-interception",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/features/schedules/schedule-interception.mdx",tags:[],version:"current",frontMatter:{title:"\ufe0f\ud83d\udee1\ufe0f Schedule Interception"},sidebar:"nyxSidebar",previous:{title:"\ufe0f\u231a Schedules",permalink:"/nyx/docs/features/schedules/schedule"},next:{title:"\ufe0f\ud83d\udcbc Schedule Manager",permalink:"/nyx/docs/features/schedules/schedule-manager"}},o={},u=[{value:"\ud83d\udea6 Schedule Middlewares",id:"-schedule-middlewares",level:2},{value:"\u2753 When to use a middleware?",id:"-when-to-use-a-middleware",level:3},{value:"\ud83d\udc77\u200d Middleware Creation",id:"-middleware-creation",level:3},{value:"\ud83d\udea7 Schedule Filters",id:"-schedule-filters",level:2},{value:"\u2753 When to use a filter?",id:"-when-to-use-a-filter",level:3},{value:"\ud83d\udc77\u200d Filter Creation",id:"-filter-creation",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Schedule interception refers to blocking a schedule from being executed. In nyx, there are two ways to do this:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a ",(0,r.jsx)(n.code,{children:"ScheduleMiddleware"})," to the ",(0,r.jsx)(n.code,{children:"ScheduleMiddlewareLinkedList"})," in the ",(0,r.jsx)(n.code,{children:"ScheduleExecutor"})," that handles\nthe schedule execution."]}),"\n",(0,r.jsxs)(n.li,{children:["Provide a ",(0,r.jsx)(n.code,{children:"ScheduleFilter"})," in the ",(0,r.jsx)(n.code,{children:"Schedule"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Let's explore when and how to use each of these methods."}),"\n",(0,r.jsx)(n.h2,{id:"-schedule-middlewares",children:"\ud83d\udea6 Schedule Middlewares"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"ScheduleMiddlewares"})," are objects stored on a ",(0,r.jsx)(n.code,{children:"ScheduleMiddlewareLinkedList"}),", which is held and called by\nthe schedule executor when a schedule is about to be executed."]}),"\n",(0,r.jsx)(n.p,{children:"It consists of:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"check()"})," method, which takes a schedule and its arguments. Returns a ",(0,r.jsx)(n.code,{children:"MiddlewareResponse"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"Priority"}),", that determines its priority inside the list."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["When being checked, a middleware is passed the schedule that is being checked and the tick metadata. The schedule then\nreplies with a ",(0,r.jsx)(n.code,{children:"MiddlewareResponse"}),", which can either:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Allow the execution (",(0,r.jsx)(n.code,{children:"{ allowed: true }"}),"), with either:"]}),"\n",(0,r.jsxs)(n.li,{children:["Making the linked list check the next middleware (",(0,r.jsx)(n.code,{children:"{ allowed: true, checkNext: true }"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Forcing the chain to end (",(0,r.jsx)(n.code,{children:"{ allowed: true, checkNext: false }"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Deny the execution (",(0,r.jsx)(n.code,{children:"{ allowed: false, checkNext: false }"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"AbstractMiddleware"}),", has ",(0,r.jsx)(n.code,{children:"protected"})," utility methods to generate these responses. Specifically, ",(0,r.jsx)(n.code,{children:"this.true()"}),",\n",(0,r.jsx)(n.code,{children:"this.false()"})," and ",(0,r.jsx)(n.code,{children:"this.forceTrue()"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Middlewares are not bot aware, meaning that you can reuse the same instance for many bots."})}),"\n",(0,r.jsx)(n.h3,{id:"-when-to-use-a-middleware",children:"\u2753 When to use a middleware?"}),"\n",(0,r.jsxs)(n.p,{children:["Middlewares are best for executing something or intercepting for all schedules. For example, the filtering\n(",(0,r.jsx)(n.code,{children:"ScheduleFilter"}),") logic is done by a middleware."]}),"\n",(0,r.jsxs)(n.p,{children:["They're very good when intercepting ",(0,r.jsx)(n.code,{children:"Schedules"})," in general, but not really for one in particular, since it\nwould be very inefficient to check all the schedules searching for only one of them."]}),"\n",(0,r.jsx)(n.h3,{id:"-middleware-creation",children:"\ud83d\udc77\u200d Middleware Creation"}),"\n",(0,r.jsx)(n.p,{children:"You can create your own middleware by either:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Extending ",(0,r.jsx)(n.code,{children:"AbstractScheduleMiddleware"})," from ",(0,r.jsx)(n.code,{children:"@framework"})," (recommended)."]}),"\n",(0,r.jsxs)(n.li,{children:["Implementing the ",(0,r.jsx)(n.code,{children:"ScheduleMiddleware"})," interface from ",(0,r.jsx)(n.code,{children:"@core"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(s.Z,{value:"Extending AbstractScheduleMiddleware",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { AbstractScheduleMiddleware } from '@nyx-discord/framework';\n\nclass MyScheduleMiddleware extends AbstractScheduleMiddleware {\n  public check(schedule: Schedule, args: ScheduleTickArgs): MiddlewareResponse {\n    return this.true();\n  }\n}\n\nconst middleware = new MyScheduleMiddleware();\n\nbot.schedules.getExecutor().getMiddleware().add(middleware);\n"})})}),(0,r.jsx)(s.Z,{value:"Implementing ScheduleMiddleware",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { ScheduleMiddleware } from '@nyx-discord/core';\n\nclass MyScheduleMiddleware implements ScheduleMiddleware {\n  // ...\n}\n\nconst middleware = new MyScheduleMiddleware();\n\nbot.schedules.getExecutor().getMiddleware().add(middleware);\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"By default, the following middleware chain is used:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ScheduleFilterCheckMiddleware"})," - See ",(0,r.jsx)(n.a,{href:"#-Schedule-filters",children:"\ud83d\udea7 Schedule Filters"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-schedule-filters",children:"\ud83d\udea7 Schedule Filters"}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"ScheduleFilter"})," is a nullable object provided by an ",(0,r.jsx)(n.code,{children:"Schedule"}),", checked by the ",(0,r.jsx)(n.code,{children:"ScheduleFilterCheckMiddleware"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Filters are not bot aware nor schedule aware, meaning that you can reuse the same instance for many schedules."})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Think of a filter like adding an ",(0,r.jsx)(n.code,{children:"if"})," at the beginning of your schedule's execution, except it gets checked before the\nschedule is executed and, since it's an object, you can reuse it for multiple schedules or save state on it."]})}),"\n",(0,r.jsxs)(n.p,{children:["Though schedules can only provide one filter, ",(0,r.jsx)(n.code,{children:"@framework"})," provides utility filter aggregators that implement the\nbasic ",(0,r.jsx)(n.code,{children:"AND"}),", ",(0,r.jsx)(n.code,{children:"OR"}),", ",(0,r.jsx)(n.code,{children:"NOT"}),' gates, that can help you "combine" multiple filters into one.']}),"\n",(0,r.jsx)(n.h3,{id:"-when-to-use-a-filter",children:"\u2753 When to use a filter?"}),"\n",(0,r.jsx)(n.p,{children:"Filters are best suited for sharing common conditions that multiple schedules should share before executing."}),"\n",(0,r.jsxs)(n.p,{children:["Also, since they have access to the schedule that is being filtered and the ",(0,r.jsx)(n.code,{children:"ScheduleExecutionMeta"}),' object, filters can\nshare information to the schedule, effectively working as a "pre-processor".']}),"\n",(0,r.jsx)(n.h3,{id:"-filter-creation",children:"\ud83d\udc77\u200d Filter Creation"}),"\n",(0,r.jsx)(n.p,{children:"You can create your own filter by either:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Extending ",(0,r.jsx)(n.code,{children:"AbstractScheduleFilter"})," from ",(0,r.jsx)(n.code,{children:"@framework"})," (recommended)."]}),"\n",(0,r.jsxs)(n.li,{children:["Implementing the ",(0,r.jsx)(n.code,{children:"ScheduleFilter"})," interface from ",(0,r.jsx)(n.code,{children:"@core"}),"."]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},9262:(e,n,t)=>{t.d(n,{Z:()=>s});t(2983);var r=t(8934);const l={tabItem:"tabItem_rG4d"};var i=t(7458);function s(e){let{children:n,hidden:t,className:s}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.Z)(l.tabItem,s),hidden:t,children:n})}},52:(e,n,t)=>{t.d(n,{Z:()=>v});var r=t(2983),l=t(8934),i=t(3743),s=t(3729),d=t(2461),c=t(8239),a=t(7333),o=t(6927);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:l}}=e;return{value:n,label:t,attributes:r,default:l}}))}(t);return function(e){const n=(0,a.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function x(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const l=(0,s.k6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,c._X)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(l.location.search);n.set(i,e),l.replace({...l.location,search:n.toString()})}),[i,l])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:l}=e,i=h(e),[s,c]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!x({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[a,u]=f({queryString:t,groupId:l}),[m,p]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[l,i]=(0,o.Nk)(t);return[l,(0,r.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:l}),j=(()=>{const e=a??m;return x({value:e,tabValues:i})?e:null})();(0,d.Z)((()=>{j&&c(j)}),[j]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!x({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),p(e)}),[u,p,i]),tabValues:i}}var p=t(2034);const j={tabList:"tabList_I6mw",tabItem:"tabItem_Qvbi"};var b=t(7458);function w(e){let{className:n,block:t,selectedValue:r,selectValue:s,tabValues:d}=e;const c=[],{blockElementScrollPositionUntilNextRender:a}=(0,i.o5)(),o=e=>{const n=e.currentTarget,t=c.indexOf(n),l=d[t].value;l!==r&&(a(n),s(l))},u=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":t},n),children:d.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>c.push(e),onKeyDown:u,onClick:o,...i,className:(0,l.Z)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function g(e){let{lazy:n,children:t,selectedValue:l}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===l));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==l})))})}function y(e){const n=m(e);return(0,b.jsxs)("div",{className:(0,l.Z)("tabs-container",j.tabList),children:[(0,b.jsx)(w,{...e,...n}),(0,b.jsx)(g,{...e,...n})]})}function v(e){const n=(0,p.Z)();return(0,b.jsx)(y,{...e,children:u(e.children)},String(n))}},6436:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>s});var r=t(2983);const l={},i=r.createContext(l);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);